<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>[PT] Heat - Introdução - GitOps</title>
<meta name="description" content="Originally published at Churrops on DevOps on December 20, 2017.  ">


  <meta name="author" content="Jose Castillo Lema">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="GitOps">
<meta property="og:title" content="[PT] Heat - Introdução">
<meta property="og:url" content="https://josecastillolema.github.io/heat-introducao/">


  <meta property="og:description" content="Originally published at Churrops on DevOps on December 20, 2017.  ">







  <meta property="article:published_time" content="2017-12-20T00:00:00-02:00">



  <meta property="article:modified_time" content="2017-10-28T18:00:58-02:00">



  

  


<link rel="canonical" href="https://josecastillolema.github.io/heat-introducao/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Jose Castillo Lema",
      "url": "https://josecastillolema.github.io/",
      "sameAs": ["https://www.linkedin.com/in/jose-castillo-lema","https://github.com/josecastillolema","https://stackoverflow.com/users/4288758/jos%c3%a9-castillo-lema","https://www.researchgate.net/profile/Jose_Castillo-Lema","https://scholar.google.com.br/citations?user=_xNpHiwAAAAJ","http://lattes.cnpq.br/7955703023492257","https://www.opennetworking.org/ambassadors/jose-castillo-lema/"]
    
  }
</script>


  <meta name="google-site-verification" content="googled48a6d8a28aaa375.html" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="GitOps Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="shortcut icon" type="image/png" href="/assets/images/favicon.ico">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/favicon_io/android-chrome-192x192.png" alt=""></a>
        
        <a class="site-title" href="/">
          GitOps
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/fiap/">fiap</a>
            </li>
<li class="masthead__menu-item">
              <a href="/mininfv/">mini-nfv</a>
            </li>
<li class="masthead__menu-item">
              <a href="/posts/">posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">about</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/me.jpg" alt="Jose Castillo Lema" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Jose Castillo Lema</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Cloud consultant @ <strong>RedHat</strong>.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Brazil, SP</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/josecastillolema" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
          
            <li><a href="https://www.linkedin.com/in/jose-castillo-lema" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/4288758/jos%c3%a9-castillo-lema" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">StackOverflow</span></a></li>
          
        
          
            <li><a href="https://www.researchgate.net/profile/Jose_Castillo-Lema" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-researchgate" aria-hidden="true"></i><span class="label">ResearchGate</span></a></li>
          
        
          
            <li><a href="https://scholar.google.com.br/citations?user=_xNpHiwAAAAJ" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-google" aria-hidden="true"></i><span class="label">GoogleScholar</span></a></li>
          
        
          
            <li><a href="http://lattes.cnpq.br/7955703023492257" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-university" aria-hidden="true"></i><span class="label">Lattes</span></a></li>
          
        
          
            <li><a href="https://ambassadors.opennetworking.org/directory/jose-castillo-lema/" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-battle-net" aria-hidden="true"></i><span class="label">ONF</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:josecastillolema@gmail.com">
            <meta itemprop="email" content="josecastillolema@gmail.com">
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="[PT] Heat - Introdução">
    <meta itemprop="description" content="Originally published at Churrops on DevOps on December 20, 2017.">
    <meta itemprop="datePublished" content="2017-12-20T00:00:00-02:00">
    <meta itemprop="dateModified" content="2017-10-28T18:00:58-02:00">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">[PT] Heat - Introdução
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  8 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#pr%C3%A9-requisitos">Pré requisitos</a></li>
  <li><a href="#descri%C3%A7%C3%A3o-do-template">Descrição do template</a></li>
  <li>
<a href="#execu%C3%A7%C3%A3o-do-template">Execução do template</a>
    <ul>
      <li><a href="#via-horizon">Via Horizon</a></li>
      <li><a href="#via-cli">Via CLI</a></li>
      <li><a href="#via-api-rest">Via API REST</a></li>
    </ul>
  </li>
  <li><a href="#resultado-da-execu%C3%A7%C3%A3o">Resultado da execução</a></li>
  <li><a href="#conclus%C3%A3o">Conclusão</a></li>
</ul>

            </nav>
          </aside>
        
        <p><em>Originally published at <a href="https://churrops.io/2017/12/20/heat-introducao/" target="_blank" rel="noopener noreferrer"><strong>Churrops on DevOps</strong></a> on December 20, 2017.</em></p>

<p>Olá pessoal, vamos começar uma série de artigos sobre Heat, o “terraform” nativo do OpenStack, ou para quem vem do mundo da AWS, o CloudFormation do OpenStack (inclusive parcialmente compatível). Neste primeiro artigo introdutório vamos aprender a criar as nossas próprias pilhas (ou <em>stacks</em>) e recriar a instância do servidor web que criamos no <a href="/terraformando-openstack">post passado</a> usando o Terraform.</p>

<p>O objetivo principal de Heat é criar um serviço para gerenciar todo o ciclo de vida de infra e aplicativos dentro do OpenStack. Ele implementa um mecanismo de orquestração com base em <em>templates</em> na forma de arquivos de texto (em formato <code class="highlighter-rouge">.yaml</code>) que podem ser tratados como código. O formato dos <code class="highlighter-rouge">templates</code> está evoluindo a cada versão do OpenStack, mas o Heat se esforça para fornecer compatibilidade com o formato do modelo AWS CloudFormation, de modo que muitos modelos CloudFormation existentes podem ser iniciados no OpenStack (inclusive permitindo, por exemplo, escalar do OpenStack para dentro da AWS). Para quem tiver interesse, existe também um esforço da comunidade para suportar templates TOSCA, chamado <a href="https://wiki.openstack.org/wiki/Heat-Translator" target="_blank" rel="noopener noreferrer">Heat Translator</a>.</p>

<p>O Heat fornece uma API REST nativa do OpenStack e uma API de consulta compatível com o CloudFormation, além de interface gráfica via Horizon (o <em>dashboard</em> de OpenStack) e um cliente para a linha de comandos (antigamente <code class="highlighter-rouge">heat</code>, nas versões mais novas de OpenStack foi integrado no próprio comando <code class="highlighter-rouge">openstack</code>).</p>

<p>Uma característica importante do Heat é que ele gerencia todo o ciclo de vida do aplicativo, e não só a criação. Quando precisar alterar a infra, simplesmente modifique o modelo e use o Heat para atualizar sua pilha existente. Heat sabe como fazer as mudanças necessárias. Ele irá excluir todos os recursos quando você terminar o aplicativo também (tipo <code class="highlighter-rouge">terraform destroy</code>).</p>

<p>Os recursos de infra que podem ser descritos incluem: instâncias, IPs públicos, volumes, grupos de segurança, usuários, roteadores, etc. Os modelos também podem especificar as relações entre recursos (por exemplo, este volume está conectado a este servidor). Isso permite que o Heat invoque as APIs do OpenStack para criar toda sua infra virtual na ordem correta para iniciar completamente sua aplicação.</p>

<p>O Heat também se integra com o Ceilometer, o módulo de telemetria do OpenStack, permitindo definir políticas de uso de <em>autoscaling</em> em função do uso dos recursos (chegaremos lá nos próximos artigos!).</p>

<p>O Heat gerencia principalmente a infra virtual, mas os modelos se integram bem com ferramentas de gerenciamento de configuração de <em>software</em>, como Puppet e Chef, e a equipe do Heat está trabalhando para fornecer uma integração ainda melhor entre infraestrutura e <em>software</em>. Existem várias opções para configurar o software que é executado nos servidores do <em>stack</em>:</p>
<ul>
  <li>Criar uma imagem personalizada (de preferência usando <a href="https://git.openstack.org/cgit/openstack/diskimage-builder" target="_blank" rel="noopener noreferrer"><strong>diskimager-builder</strong></a>)</li>
  <li>Via <a href="https://cloud-init.io/" target="_blank" rel="noopener noreferrer"><strong>cloud-init</strong></a>, um script que é executado durante o primeiro boot. Esta será a forma que usaremos ao longo dos artigos.</li>
  <li>Um recurso do heat, de tipo <strong><em>software deployment</em></strong>.</li>
</ul>

<p>Sem mais, vamos criar o nosso primeiro <em>stack</em> e recriar o nosso servidor web.</p>

<h2 id="pré-requisitos">Pré requisitos</h2>

<ul>
  <li>Uma conta em alguma nuvem OpenStack, não necessariamente <code class="highlighter-rouge">admin</code>
</li>
  <li>Quota suficiente na nossa conta para instanciar os recursos solicitados</li>
</ul>

<p>No repositório <a href="https://github.com/josecastillolema/churrops.git" target="_blank" rel="noopener noreferrer">https://github.com/josecastillolema/churrops.git</a> podem fazer <em>download</em> do arquivo heat.yaml, o <em>template</em> que usaremos durante este artigo.</p>

<h2 id="descrição-do-template">Descrição do <em>template</em>
</h2>
<p>As duas primeras linhas mostram a versão em uso do formato do template e uma descrição do conteúdo do mesmo:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">heat_template_version</span><span class="pi">:</span> <span class="s">2016-04-08</span>
<span class="na">description</span><span class="pi">:</span> <span class="s">Servidor web para churrops!</span>
</code></pre></div></div>

<p>A seguir, o primeiro bloco do <em>template</em>, <code class="highlighter-rouge">parameters</code>, define uma série de parâmetros que serão usados durante o <em>deployment</em> da infra (de forma análoga ao bloco <code class="highlighter-rouge">variable</code> no caso do Terraform). Podemos definir neste bloco imagem, <em>flavor</em>, redes, chaves para acessar aos nossos servidores, etc. Para cada parâmetro definido podemos adicionar uma descrição e um valor padrão.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">parameters</span><span class="pi">:</span>
  <span class="na">flavor</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Flavor para o servidor web</span>
    <span class="na">constraints</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">custom_constraint</span><span class="pi">:</span> <span class="s">nova.flavor</span>
    <span class="na">default</span><span class="pi">:</span> <span class="s">g1.micro</span>
  <span class="na">image</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Imagem para o servidor web</span>
    <span class="na">constraints</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">custom_constraint</span><span class="pi">:</span> <span class="s">glance.image</span>
    <span class="na">default</span><span class="pi">:</span> <span class="s">linux-ubuntu-16-64b-base</span>
  <span class="na">private_network</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Rede interna</span>
    <span class="na">constraints</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">custom_constraint</span><span class="pi">:</span> <span class="s">neutron.network</span>
    <span class="na">default</span><span class="pi">:</span> <span class="s">net-int1</span>
  <span class="na">private_ip</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">IP interna do servidor</span>
    <span class="na">default</span><span class="pi">:</span> <span class="s">10.0.0.200</span>
  <span class="na">key_name</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">A chave ssh para acessar a nossa vm</span>
    <span class="na">constraints</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">custom_constraint</span><span class="pi">:</span> <span class="s">nova.keypair</span>
    <span class="na">default</span><span class="pi">:</span> <span class="s">devel</span>
  <span class="na">public_network</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Rede publica</span>
    <span class="na">constraints</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">custom_constraint</span><span class="pi">:</span> <span class="s">neutron.network</span>
  <span class="na">texto</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Texto exibido no site</span>
    <span class="na">default</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Churrops</span><span class="nv"> </span><span class="s">rules"</span>
</code></pre></div></div>
<p>No segundo bloco, <code class="highlighter-rouge">resources</code>, é a onde vamos definir os recursos da nossa infra. Neste caso vamos definir o nosso servidor web. Podem consultar uma lista de todos os recursos disponíveis <a href="https://docs.openstack.org/heat/pike/template_guide/openstack.html" target="_blank" rel="noopener noreferrer">aqui</a>. O servidor web é configurado via <strong>cloud-init</strong> no primeiro <em>boot</em>. Vejam que é possível passar parâmetros para os recursos, como neste caso o parâmetro <code class="highlighter-rouge">TEXTO</code>.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">resources</span><span class="pi">:</span>
  <span class="na">sec_group</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">OS::Neutron::SecurityGroup</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">rules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">remote_ip_prefix</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
        <span class="na">protocol</span><span class="pi">:</span> <span class="s">icmp</span>
      <span class="pi">-</span> <span class="na">remote_ip_prefix</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
        <span class="na">protocol</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">port_range_min</span><span class="pi">:</span> <span class="m">80</span>
        <span class="na">port_range_max</span><span class="pi">:</span> <span class="m">80</span>
      <span class="pi">-</span> <span class="na">remote_ip_prefix</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
        <span class="na">protocol</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">port_range_min</span><span class="pi">:</span> <span class="m">22</span>
        <span class="na">port_range_max</span><span class="pi">:</span> <span class="s">22</span> 

  <span class="na">serverweb_port</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">OS::Neutron::Port</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">network_id</span><span class="pi">:</span> <span class="pi">{</span> <span class="nv">get_param</span><span class="pi">:</span> <span class="nv">private_network</span> <span class="pi">}</span>
      <span class="na">security_groups</span><span class="pi">:</span> <span class="pi">[{</span> <span class="nv">get_resource</span><span class="pi">:</span> <span class="nv">sec_group</span> <span class="pi">}]</span>

  <span class="na">serverweb</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">OS::Nova::Server</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="pi">{</span> <span class="nv">get_param</span><span class="pi">:</span> <span class="nv">image</span> <span class="pi">}</span>
      <span class="na">flavor</span><span class="pi">:</span> <span class="pi">{</span> <span class="nv">get_param</span><span class="pi">:</span> <span class="nv">flavor</span> <span class="pi">}</span>
      <span class="na">networks</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="pi">{</span> <span class="nv">get_resource</span><span class="pi">:</span> <span class="nv">serverweb_port</span> <span class="pi">}</span>
      <span class="na">user_data_format</span><span class="pi">:</span> <span class="s">RAW</span>
      <span class="na">key_name</span><span class="pi">:</span> <span class="pi">{</span> <span class="nv">get_param</span><span class="pi">:</span> <span class="nv">key_name</span> <span class="pi">}</span>
      <span class="na">user_data</span><span class="pi">:</span>
        <span class="na">str_replace</span><span class="pi">:</span>
          <span class="na">template</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">#!/bin/bash</span>
            <span class="s">sudo -i</span>
            <span class="s">apt-get update</span>
            <span class="s">apt-get install -y apache2</span>
            <span class="s">cat &lt; /var/www/html/index.html                                   </span>
            <span class="s">Churrops!!! o/</span>
            <span class="s">hostname: $(hostname)</span>
            <span class="s">parametro: TEXTO</span>
            <span class="s">EOF</span>
          <span class="na">params</span><span class="pi">:</span>
            <span class="na">TEXTO</span><span class="pi">:</span> <span class="pi">{</span> <span class="nv">get_param</span><span class="pi">:</span> <span class="nv">texto</span> <span class="pi">}</span>

  <span class="na">floating_ip</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">OS::Neutron::FloatingIP</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">floating_network</span><span class="pi">:</span> <span class="pi">{</span> <span class="nv">get_param</span><span class="pi">:</span> <span class="nv">public_network</span> <span class="pi">}</span>
      <span class="na">port_id</span><span class="pi">:</span> <span class="pi">{</span> <span class="nv">get_resource</span><span class="pi">:</span> <span class="nv">serverweb_port</span> <span class="pi">}</span>
</code></pre></div></div>
<p>O terceiro e ultimo bloco, <code class="highlighter-rouge">outputs</code>, tem uma função análoga ao arquivo <code class="highlighter-rouge">output.tf</code> do Terraform. Ele define uma saída que será mostrada ao usuário ao terminar a criação da infra.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">outputs</span><span class="pi">:</span>
  <span class="na">lburl</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">URL do servidor web</span>
    <span class="na">value</span><span class="pi">:</span>
      <span class="na">str_replace</span><span class="pi">:</span>
        <span class="na">template</span><span class="pi">:</span> <span class="s">http://IP_ADDRESS</span>
        <span class="na">params</span><span class="pi">:</span>
          <span class="na">IP_ADDRESS</span><span class="pi">:</span> <span class="pi">{</span> <span class="nv">get_attr</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">floating_ip</span><span class="pi">,</span> <span class="nv">floating_ip_address</span> <span class="pi">]</span> <span class="pi">}</span>
    <span class="na">description</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">Esta URL e a URL "externa" que pode ser usada para acessar o servidor WEB.</span>
</code></pre></div></div>

<h2 id="execução-do-template">Execução do <em>template</em>
</h2>

<h3 id="via-horizon">Via Horizon</h3>
<p>Primeiro, na aba <code class="highlighter-rouge">Orquestration - Stacks</code> criamos o nosso <em>stack</em> e setamos os parâmetros opcionais que foram definidos no template.
<img src="/assets/images/posts/2017-12-20-heat-introducao/01.png" alt=""></p>

<p>A continuação podemos ver a topologia diversos recursos sendo criados (os recursos em verde já estão disponíveis).
<img src="/assets/images/posts/2017-12-20-heat-introducao/02.png" alt=""></p>

<p>Um <em>overview</em> da nossa pilha, com o <em>output</em> que definimos no <em>template</em>.
<img src="/assets/images/posts/2017-12-20-heat-introducao/03.png" alt=""></p>

<p>Os recursos que estão sendo criados.
<img src="/assets/images/posts/2017-12-20-heat-introducao/04.png" alt=""></p>

<p>E por último todos os eventos relacionados com esses recursos (criação, atualização, modificação, deleção, etc.).
<img src="/assets/images/posts/2017-12-20-heat-introducao/05.png" alt=""></p>

<h3 id="via-cli">Via CLI</h3>
<ul>
  <li>Criação:
    <div class="highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>openstack stack create churrops-stack -t heat.yaml
openstack stack create churrops-stack -t heat.yaml
</code></pre></div>    </div>
  </li>
  <li>Para acompanhar a criação:
    <div class="highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>watch openstack stack event list churrops-stack

</code></pre></div>    </div>
  </li>
</ul>

<h3 id="via-api-rest">Via API REST</h3>
<p>Como falamos na introdução, o Heat fornece uma API REST nativa do OpenStack e uma API de consulta compatível com o CloudFormation. Neste caso usaremos a API REST nativa.</p>

<p><img src="/assets/images/posts/2017-12-20-heat-introducao/06.png" alt=""></p>

<h2 id="resultado-da-execução">Resultado da execução</h2>

<p>Independentemente do método escolhido (Horizon, CLI ou API REST), uma vez que o <em>stack</em> transicione ao estado <code class="highlighter-rouge">created</code> (não deveria demorar muito mais de 2 minutos) poderemos ver a infra instanciada.
<img src="/assets/images/posts/2017-12-20-heat-introducao/07.png" alt=""></p>

<p>Em alguns minutos (enquanto <strong>cloud-init</strong> instala e configura o servidor web Apache), poderemos acessar ao nosso servidor pela IP pública.
<img src="/assets/images/posts/2017-12-20-heat-introducao/07.png" alt=""></p>

<h2 id="conclusão">Conclusão</h2>
<p>Neste artigo introduzimos o Heat, o orquestrador do OpenStack. Vimos como mantém todas as funcionalidades de outros IaCs, como Terraform, mas é integrado de uma forma mais nativa no OpenStack e podemos accesá-lo via <em>dashboard</em>	, linha de comandos ou API REST (compatível com a AWS CloudFormation).</p>

<p>Nos próximos artigos veremos como criar via Heat um balanceador de carga em alta disponibilidade usando <code class="highlighter-rouge">haproxy</code> e VRRP.</p>

<p>Um abraço!</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#iac" class="page__taxonomy-item" rel="tag">iac</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#openstack" class="page__taxonomy-item" rel="tag">openstack</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#pt" class="page__taxonomy-item" rel="tag">pt</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#redhat" class="page__taxonomy-item" rel="tag">redhat</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-10-28">October 28, 2017</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/terraformando-openstack/" class="pagination--pager" title="[PT] Terraform – IaC – Terraformando no OpenStack
">Previous</a>
    
    
      <a href="/hntd-11/" class="pagination--pager" title="HCNA-HNTD Training - 11th edition
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/aws-academy/" rel="permalink">AWS Academy
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/aodh2sensu/" rel="permalink">aodh2sensu - importing alarms from Aodh into Sensu Core
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">



</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ussuri-contributor-list/" rel="permalink">OpenStack Ussuri Contributor List
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">https://www.openstack.org/software/ussuri/
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/osp43-on-rhosp13/" rel="permalink">OpenShift 4.3 on RHOSP 13: Installation and Integrations
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">I would like to share my experience installing and integrating OpenShift with various OpenStack services, namely Cinder, Swift and Keystone (Neutron and Octa...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/josecastillolema" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
        
          <li><a href="https://www.linkedin.com/in/jose-castillo-lema" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://stackoverflow.com/users/4288758/jos%c3%a9-castillo-lema" rel="noopener noreferrer" target="_blank"><i class="fab fa-stack-overflow" aria-hidden="true"></i> Stack Overflow</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2020 Jose Castillo Lema. Powered by <a href="https://jekyllrb.com" rel="noopener noreferrer" target="_blank">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="noopener noreferrer" target="_blank">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-169326084-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>









  </body>
</html>
